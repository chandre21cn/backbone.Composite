/*Backbone.CompositeView*/(function(i,t){function e(i){return"[object Array]"===Object.prototype.toString.apply(i)}function n(i){var t=i.split(" "),e=t[0],n=t[1];return{target:n,event:e}}function s(i,t){var n,s,r,o,f,l,h;for(n=0,s=i.length;s>n;n++){if(f=i[n],"string"==typeof f)if(r=f.lastIndexOf("."),-1===r)f=this[f],l=this;else{if(o=f.slice(r+1),h=f.slice(0,r),l=this.getSubView(h),e(l)){for(j=0,s=l.length;s>j;j++)tpmView=l[j],t(h,o,tpmView,tpmView[o]);continue}f=l[o]}t("function","function",l,f)}}function r(i,t,e){s.call(this,e,function(e,n,s,r){i.on(t,r,s)})}function o(i,t,n){var s,o;if(e(i))for(s=0,o=i.length;o>s;s++)r.call(this,i[s],t,n);else r.call(this,i,t,n)}function f(i,t){var e,n=this.ve[i].bind;if(!n)return!1;for(e in n)o.call(this,t,e,n[e]);return!0}function l(i,t){var e,n,s,r=this.ve[i].listen;for(e in r)n=r[e].split(" "),s=this.getSubView(n[1]),o(s,n[0],[t[e]])}function h(){var i,t,e,n=this.itemViews,s=this.iv;for(i in n)t=s[i]=n[i],e=this.ve[i]={},e.bind={},e.listen={},"function"==typeof t&&(s[i]=t())}function u(){var i,t,e,s,r,f,l,h,u,a=this.viewsEvents;for(l in a)if(i=a[l],"function"==typeof i&&(i=i()),t=n(l),e=t.event,s=t.target,r=this.getSubView(s),-1===s.indexOf(".")&&(binds=this.ve[s].bind),-1===s.indexOf(".")&&(binds[e]=i),r&&i.length){o.call(this,r,e,i);for(var c=0,v=i.length;v>c;c++)f=i[c],"function"!=typeof f&&(u=f.split("."),2===u.length&&-1!==h&&(this.ve[u[0]].listen[[u[1]]]=l))}}function a(){var i,n,s,r,o,f,l,h,u,a,c=this.nestViews;for(n in c)if(h=t(),l=null,i=this.getSubView(n),i?(e(i)&&(i=i[0]),f=i.$el):f=t(n),!(1>f.size())){for(r=c[n],"function"==typeof r&&(r=r()),o=r.length,s=0;o>s;s++){var v=r[s];if("object"==typeof v)l=v.$el?v.$el:v;else if("string"==typeof v)if(i=this.getSubView(v),e(i))for(u=0,a=i.length;a>u;u++)h=h.add(i[u].$el);else l=i?i.$el:t(v);l&&l.size()>=1&&(h=h.add(l))}h.size()>=1&&f.append(h)}}i.CompositeView=i.View.extend({itemViews:{},viewsEvents:{},nestViews:{},constructor:function(){this.iv={},this.ve={},h.apply(this),u.apply(this),a.apply(this),this.initialize()},setSubView:function(i,t,e){var e=e||!0;return this.trigger("set",i,t),this.trigger("set:"+i,i,t),this.iv[i]?(e&&f.call(this,i,t),void 0):(this.iv[i]=t,this.trigger("add",i,t),this.trigger("add:"+i,i,t),void 0)},getSubView:function(i){var t,e,n;if("string"!=typeof i)return null;if(n=i.indexOf("."),-1===n)return this.iv[i]?this.iv[i]:null;var s;return t=i.slice(n+1),e=i.slice(0,n),s=this.iv[e],s?"function"==typeof s.getSubView?s.getSubView(t):s:null},appendSubView:function(i,t,n,s){var r,o,h=this.getSubView(i);if(r="boolean"!=typeof n?!0:n,o="boolean"!=typeof s?!0:s,!h)throw"subview not found";if(!e(h))throw"Subview is not an array";h.push(t),r&&f.call(this,i,t),o&&l.call(this,i,t)},delSubView:function(i){return this.iv[i]?(delete this.iv[i],this.ve[i]&&delete this.ve[i],this.trigger("remove"),this.trigger("remove:"+i),!0):!1}})})(Backbone,jQuery);