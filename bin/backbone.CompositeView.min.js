/*Backbone.CompositeView*/(function(i,t){function e(i){return"[object Array]"===Object.prototype.toString.apply(i)}function n(i){var t=i.split(" "),e=t[0],n=t[1];return{target:n,event:e}}function s(i,t){var n,s,r,l,o,f,h;for(n=0,s=i.length;s>n;n++){if(o=i[n],"string"==typeof o)if(r=o.lastIndexOf("."),-1===r)o=this[o],f=this;else{if(l=o.slice(r+1),h=o.slice(0,r),f=this.getSubView(h),e(f)){for(j=0,s=f.length;s>j;j++)tpmView=f[j],t(h,l,tpmView,tpmView[l]);continue}o=f[l]}t("function","function",f,o)}}function r(i,t,e){s.call(this,e,function(e,n,s,r){i.on(t,r,s)})}function l(i,t,n){var s,l;if(e(i))for(s=0,l=i.length;l>s;s++)r.call(this,i[s],t,n);else r.call(this,i,t,n)}function o(i,t){var e,n=this.ve[i].bind;if(!n)return!1;for(e in n)l.call(this,t,e,n[e]);return!0}function f(i,t){var e,n,s,r=this.ve[i].listen;for(e in r)n=r[e].split(" "),s=this.getSubView(n[1]),l(s,n[0],[t[e]])}function h(i,e){var n,s=this.nv[i];""!==s&&(n=this.getSubView(s),n?n.$el.append(e.$el):t(s).append(e.$el))}function u(){var i,t,e,n=this.itemViews,s=this.iv;for(i in n)t=s[i]=n[i],e=this.ve[i]={},this.nv[i]="",e.bind={},e.listen={},"function"==typeof t&&(s[i]=t())}function v(){var i,t,e,s,r,o,f,h,u,v=this.viewsEvents;for(f in v)if(i=v[f],"function"==typeof i&&(i=i()),t=n(f),e=t.event,s=t.target,r=this.getSubView(s),-1===s.indexOf(".")&&(binds=this.ve[s].bind,binds[e]=i),r&&i.length){l.call(this,r,e,i);for(var a=0,c=i.length;c>a;a++)o=i[a],"function"!=typeof o&&(u=o.split("."),2===u.length&&-1!==h&&(this.ve[u[0]].listen[[u[1]]]=f))}}function a(){var i,n,s,r,l,o,f,h,u,v,a,c,g,p=this.nestViews;for(v in p)if(h=t(),f=null,u=v.split(" "),n=u[0],a=u[1]?u[1]:null,i=this.getSubView(n),i?(e(i)&&(i=i[0]),o=i.$el,a&&(o=o.find(a))):o=t(v),!(1>o.size())){for(r=p[v],"function"==typeof r&&(r=r()),l=r.length,s=0;l>s;s++){var d=r[s];if("object"==typeof d)f=d.$el?d.$el:d;else if("string"==typeof d)if(i=this.getSubView(d),i&&-1===d.indexOf(".")&&(this.nv[d]=n),e(i))for(c=0,g=i.length;g>c;c++)h=h.add(i[c].$el);else f=i?i.$el:t(d);f&&f.size()>=1&&(h=h.add(f))}h.size()>=1&&o.append(h)}}i.CompositeView=i.View.extend({itemViews:{},viewsEvents:{},nestViews:{},constructor:function(){this.iv={},this.ve={},this.nv={},u.apply(this),v.apply(this),a.apply(this),this.initialize()},setSubView:function(i,t,e){var e=e||!0;return this.trigger("set",i,t),this.trigger("set:"+i,i,t),this.iv[i]?(e&&o.call(this,i,t),void 0):(this.iv[i]=t,this.trigger("add",i,t),this.trigger("add:"+i,i,t),void 0)},getSubView:function(i){var t,e,n;if("string"!=typeof i)return null;if(n=i.indexOf("."),-1===n)return this.iv[i]?this.iv[i]:null;var s;return t=i.slice(n+1),e=i.slice(0,n),s=this.iv[e],s?"function"==typeof s.getSubView?s.getSubView(t):s:null},appendSubView:function(i,t,n){var s,r=this.getSubView(i);if(s={bind:!0,listen:!0,nest:!0},_.extend(s,n),!r)throw"subview not found";if(!e(r))throw"Subview is not an array";r.push(t),s.bind&&o.call(this,i,t),s.listen&&f.call(this,i,t),s.nest&&h.call(this,i,t),this.trigger("append",i,t),this.trigger("append:"+i,t)},delSubView:function(i){return this.iv[i]?(delete this.iv[i],this.ve[i]&&delete this.ve[i],this.trigger("remove"),this.trigger("remove:"+i),!0):!1}})})(Backbone,jQuery);